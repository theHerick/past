<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasta Compartilhada - Colaboração em Tempo Real</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 0;
        }

        /* Navbar */
        nav {
            background: white;
            border-bottom: 1px solid #e1e4e8;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            text-decoration: none;
        }

        .logo-icon {
            font-size: 1.5em;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-link {
            color: #586069;
            text-decoration: none;
            font-size: 0.95em;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: #0366d6;
        }

        .btn-new-folder {
            background: #0366d6;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-new-folder:hover {
            background: #0256c7;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 8px;
            margin-bottom: 40px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }

        .hero h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.1em;
            color: #586069;
            max-width: 600px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

        .hero-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #0366d6;
            color: white;
        }

        .btn-primary:hover {
            background: #0256c7;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(3,102,214,0.3);
        }

        .btn-secondary {
            background: white;
            color: #0366d6;
            border: 1px solid #0366d6;
        }

        .btn-secondary:hover {
            background: #f6f8fa;
        }

        /* Plans Section */
        .plans-section {
            margin-bottom: 40px;
        }

        .plans-section h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2em;
            font-weight: 600;
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .plan-card {
            background: white;
            border-radius: 8px;
            padding: 30px;
            border: 2px solid #e1e4e8;
            transition: all 0.2s;
            position: relative;
        }

        .plan-card:hover {
            border-color: #0366d6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .plan-card.popular {
            border-color: #0366d6;
            box-shadow: 0 4px 16px rgba(3,102,214,0.15);
        }

        .plan-badge {
            position: absolute;
            top: -12px;
            right: 20px;
            background: #0366d6;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .plan-card h3 {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .plan-price {
            font-size: 2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .plan-price span {
            font-size: 0.5em;
            color: #586069;
            font-weight: 400;
        }

        .plan-features {
            list-style: none;
            margin-bottom: 25px;
        }

        .plan-features li {
            padding: 10px 0;
            color: #586069;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .plan-features li::before {
            content: "✓";
            color: #28a745;
            font-weight: bold;
        }

        .btn-select {
            width: 100%;
            padding: 12px;
            background: #0366d6;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-select:hover {
            background: #0256c7;
        }

        /* Create Section */
        .create-section {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }

        .create-section h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 600;
        }

        .create-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .create-option {
            background: #f6f8fa;
            border: 2px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .create-option:hover {
            border-color: #0366d6;
            background: white;
            transform: translateY(-2px);
        }

        .create-option.active {
            border-color: #0366d6;
            background: #f1f8ff;
        }

        /* Items da Pasta */
        .folder-items {
            margin-top: 25px;
        }

        .folder-item {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .folder-item-header {
            background: #f6f8fa;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .folder-item-header:hover {
            background: #e1e4e8;
        }

        .folder-item-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #2c3e50;
        }

        .folder-item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-toggle {
            background: none;
            border: none;
            color: #586069;
            cursor: pointer;
            font-size: 1.2em;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .btn-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .btn-delete-item {
            background: #d73a49;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background 0.2s;
        }

        .btn-delete-item:hover {
            background: #cb2431;
        }

        .folder-item-content {
            padding: 15px;
            border-top: 1px solid #e1e4e8;
        }

        .folder-item-content.collapsed {
            display: none;
        }

        .btn-add-item {
            width: 100%;
            padding: 12px;
            background: #0366d6;
            color: white;
            border: 2px dashed #0366d6;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .btn-add-item:hover {
            background: #0256c7;
            border-color: #0256c7;
        }

        .create-option-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .create-option-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .create-option-desc {
            font-size: 0.85em;
            color: #586069;
        }

        .upload-area {
            border: 2px dashed #d1d5da;
            border-radius: 6px;
            padding: 40px 20px;
            text-align: center;
            background: #fafbfc;
            transition: all 0.2s;
            cursor: pointer;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: #0366d6;
            background: #f1f8ff;
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.6;
        }

        .upload-text {
            font-size: 1.1em;
            color: #2c3e50;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .upload-hint {
            color: #586069;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .btn-upload {
            padding: 10px 24px;
            background: #0366d6;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-upload:hover {
            background: #0256c7;
        }

        .files-list {
            margin-top: 20px;
        }

        .files-list h3 {
            font-size: 1.1em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f6f8fa;
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid #e1e4e8;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .file-icon {
            font-size: 1.3em;
        }

        .file-details {
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-weight: 500;
            color: #2c3e50;
            font-size: 0.95em;
        }

        .file-size {
            font-size: 0.85em;
            color: #586069;
        }

        .btn-remove {
            background: #d73a49;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.9em;
        }

        .btn-remove:hover {
            background: #cb2431;
        }

        .code-editor,
        .text-editor {
            width: 100%;
            min-height: 400px;
            padding: 20px;
            border: none;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            background: #fafbfc;
            color: #24292e;
        }

        .text-editor {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .code-editor:focus,
        .text-editor:focus {
            outline: none;
            background: white;
        }

        .editor-lang-select {
            padding: 6px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            background: white;
            color: #2c3e50;
            font-size: 0.9em;
            cursor: pointer;
        }

        .btn-create {
            width: 100%;
            padding: 14px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.05em;
            font-weight: 500;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.2s;
        }

        .btn-create:hover {
            background: #269f42;
        }

        .btn-create:disabled {
            background: #94d3a2;
            cursor: not-allowed;
        }

        /* Link Section */
        .link-section {
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .link-section h2 {
            text-align: center;
            color: #28a745;
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 600;
        }

        .link-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .link-box {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .link-label {
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 12px;
        }

        .link-display {
            display: flex;
            gap: 10px;
        }

        .link-display input {
            flex: 1;
            padding: 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 0.95em;
            background: white;
            font-family: 'Consolas', monospace;
        }

        .btn-copy {
            padding: 12px 20px;
            background: #0366d6;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .btn-copy:hover {
            background: #0256c7;
        }

        .btn-copy.copied {
            background: #28a745;
        }

        .link-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #f6f8fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }

        .info-icon {
            font-size: 1.5em;
        }

        .info-item strong {
            color: #2c3e50;
            font-size: 0.85em;
            display: block;
            margin-bottom: 3px;
        }

        .info-item span {
            color: #586069;
            font-size: 0.9em;
        }

        .link-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .folder-info {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .info-label {
            font-weight: 500;
            color: #586069;
        }

        .info-value {
            color: #0366d6;
            font-weight: 600;
        }

        .folder-name-input,
        .password-input {
            margin-bottom: 20px;
        }

        .folder-name-input label,
        .password-input label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }

        .folder-name-input input,
        .password-input input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        .folder-name-input input:focus,
        .password-input input:focus {
            outline: none;
            border-color: #0366d6;
            box-shadow: 0 0 0 3px rgba(3,102,214,0.1);
        }

        footer {
            text-align: center;
            color: #586069;
            margin-top: 60px;
            padding: 20px;
            font-size: 0.9em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2em;
            }
            
            .plans-grid {
                grid-template-columns: 1fr;
            }
            
            .create-options {
                grid-template-columns: 1fr;
            }
            
            .link-actions {
                flex-direction: column;
            }
            
            .btn-primary,
            .btn-secondary {
                width: 100%;
            }

            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav>
        <div class="nav-container">
            <a href="https://theherick.github.io/past/" class="logo">
                <span class="logo-icon">📁</span>
                Pasta Compartilhada
            </a>
            <div class="nav-links">
                <a href="#" class="nav-link">Como Funciona</a>
                <a href="#" class="nav-link">Planos</a>
                <button class="btn-new-folder" onclick="showCreateSection()">+ Nova Pasta</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Hero Section -->
        <div class="hero" id="heroSection">
            <h1>Colabore em Tempo Real</h1>
            <p>Crie pastas compartilhadas, edite documentos e códigos juntos. Simples, rápido e colaborativo.</p>
            <div class="hero-buttons">
                <button class="btn-primary" onclick="showCreateSection()">Criar Pasta Grátis</button>
                <button class="btn-secondary" onclick="document.getElementById('plansSection').scrollIntoView({ behavior: 'smooth' })">Ver Planos</button>
            </div>
        </div>

        <!-- Seção de Planos -->
        <section class="plans-section" id="plansSection">
            <h2>Escolha seu Plano</h2>
            <div class="plans-grid">
                <div class="plan-card" data-plan="free">
                    <h3>Grátis</h3>
                    <div class="plan-price">R$ 0</div>
                    <ul class="plan-features">
                        <li>Até 100MB por pasta</li>
                        <li>Válido por 24 horas</li>
                        <li>Upload de arquivos</li>
                        <li>Edição de texto</li>
                        <li>Link compartilhável</li>
                    </ul>
                    <button class="btn-select" onclick="selectPlan('free', 100)">Começar Grátis</button>
                </div>

                <div class="plan-card popular" data-plan="pro">
                    <div class="plan-badge">Mais Popular</div>
                    <h3>Pro</h3>
                    <div class="plan-price">R$ 9,90<span>/mês</span></div>
                    <ul class="plan-features">
                        <li>Até 1GB por pasta</li>
                        <li>Válido por 7 dias</li>
                        <li>Editor de código colaborativo</li>
                        <li>Syntax highlighting</li>
                        <li>Senha de proteção</li>
                        <li>10 pastas simultâneas</li>
                    </ul>
                    <button class="btn-select" onclick="selectPlan('pro', 1024)">Assinar Pro</button>
                </div>

                <div class="plan-card" data-plan="premium">
                    <h3>Premium</h3>
                    <div class="plan-price">R$ 19,90<span>/mês</span></div>
                    <ul class="plan-features">
                        <li>Até 5GB por pasta</li>
                        <li>Válido por 30 dias</li>
                        <li>Tudo do Pro +</li>
                        <li>Colaboração em tempo real</li>
                        <li>Histórico de versões</li>
                        <li>Pastas ilimitadas</li>
                        <li>Suporte prioritário</li>
                    </ul>
                    <button class="btn-select" onclick="selectPlan('premium', 5120)">Assinar Premium</button>
                </div>
            </div>
        </section>

        <!-- Seção de Criação -->
        <section class="create-section" id="createSection" style="display: none;">
            <h2>Criar Nova Pasta Compartilhada</h2>
            
            <div style="max-width: 800px; margin: 0 auto;">
                <div class="folder-info">
                    <div class="info-row">
                        <span class="info-label">Plano:</span>
                        <span class="info-value" id="selectedPlan">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Limite:</span>
                        <span class="info-value" id="sizeLimit">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Validade:</span>
                        <span class="info-value" id="validity">-</span>
                    </div>
                </div>

                <div class="folder-name-input">
                    <label for="folderName">Nome da Pasta</label>
                    <input type="text" id="folderName" placeholder="Ex: Projeto 2025">
                </div>

                <div class="folder-name-input">
                    <label for="creatorName">Seu Nome (opcional)</label>
                    <input type="text" id="creatorName" placeholder="Como quer ser identificado?">
                </div>

                <div class="password-input" id="passwordSection" style="display: none;">
                    <label for="folderPassword">Senha de Proteção (opcional)</label>
                    <input type="password" id="folderPassword" placeholder="Digite uma senha">
                </div>

                <!-- Itens da Pasta -->
                <div class="folder-items" id="folderItems">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">Itens da Pasta:</h3>
                    <div id="itemsList"></div>
                    
                    <button class="btn-add-item" onclick="showAddItemMenu()">
                        ➕ Adicionar Item
                    </button>
                </div>

                <!-- Menu de Adicionar Item -->
                <div id="addItemMenu" style="display: none; margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">Escolha o tipo de item:</h3>
                    <div class="create-options">
                        <div class="create-option" onclick="addNewItem('upload')">
                            <div class="create-option-icon">📤</div>
                            <div class="create-option-title">Arquivos</div>
                            <div class="create-option-desc">Upload de arquivos</div>
                        </div>
                        <div class="create-option" onclick="addNewItem('text')">
                            <div class="create-option-icon">📝</div>
                            <div class="create-option-title">Texto</div>
                            <div class="create-option-desc">Documento de texto</div>
                        </div>
                        <div class="create-option" onclick="addNewItem('code')">
                            <div class="create-option-icon">💻</div>
                            <div class="create-option-title">Código</div>
                            <div class="create-option-desc">Editor de código</div>
                        </div>
                    </div>
                </div>

                <button class="btn-create" id="btnCreate" onclick="createFolder()">
                    Criar Pasta e Gerar Link
                </button>
            </div>
        </section>

        <!-- Seção de Link Gerado -->
        <section class="link-section" id="linkSection" style="display: none;">
            <h2>✅ Pasta Criada com Sucesso!</h2>
            <div class="link-container">
                <div class="link-box">
                    <div class="link-label">Link para Compartilhar:</div>
                    <div class="link-display">
                        <input type="text" id="generatedLink" readonly>
                        <button class="btn-copy" onclick="copyLink()">
                            <span id="copyText">Copiar</span>
                        </button>
                    </div>
                </div>

                <div class="link-info">
                    <div class="info-item">
                        <span class="info-icon">📊</span>
                        <div>
                            <strong>Tamanho</strong>
                            <span id="totalSize">-</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <span class="info-icon">📁</span>
                        <div>
                            <strong>Conteúdo</strong>
                            <span id="fileCount">-</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <span class="info-icon">⏰</span>
                        <div>
                            <strong>Expira em</strong>
                            <span id="expiryTime">-</span>
                        </div>
                    </div>
                    <div class="info-item" id="passwordInfo" style="display: none;">
                        <span class="info-icon">🔒</span>
                        <div>
                            <strong>Protegido</strong>
                            <span>Com senha</span>
                        </div>
                    </div>
                </div>

                <div class="link-actions">
                    <button class="btn-secondary" onclick="openLink()">
                        Abrir Pasta
                    </button>
                    <button class="btn-primary" onclick="createAnother()">
                        Criar Outra
                    </button>
                </div>
            </div>
        </section>

        <footer>
            <p>&copy; 2025 Pasta Compartilhada - Colaboração Simples e Rápida</p>
        </footer>
    </div>

    <script>
        console.log('🎯 JavaScript carregado com sucesso!');
        
        // Estado da aplicação
        let currentPlan = null;
        let maxSize = 0;
        let folderItems = [];
        let itemIdCounter = 0;

        // Configurações dos planos
        const planConfigs = {
            free: {
                name: 'Grátis',
                maxSize: 100,
                validity: '24 horas',
                validityHours: 24,
                hasPassword: false
            },
            pro: {
                name: 'Pro',
                maxSize: 1024,
                validity: '7 dias',
                validityHours: 168,
                hasPassword: true
            },
            premium: {
                name: 'Premium',
                maxSize: 5120,
                validity: '30 dias',
                validityHours: 720,
                hasPassword: true
            }
        };

        function showCreateSection() {
            if (!currentPlan) {
                currentPlan = 'free';
                maxSize = 100;
                const config = planConfigs['free'];
                document.getElementById('selectedPlan').textContent = config.name;
                document.getElementById('sizeLimit').textContent = '100 MB';
                document.getElementById('validity').textContent = config.validity;
                document.getElementById('passwordSection').style.display = 'none';
            }
            
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('plansSection').style.display = 'none';
            document.getElementById('createSection').style.display = 'block';
            document.getElementById('linkSection').style.display = 'none';
            
            if (folderItems.length === 0) {
                renderFolderItems();
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showAddItemMenu() {
            const menu = document.getElementById('addItemMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        function addNewItem(type) {
            const itemId = itemIdCounter++;
            
            const item = {
                id: itemId,
                type: type,
                collapsed: false
            };

            if (type === 'upload') {
                item.files = [];
                item.filesData = [];
                item.name = 'Arquivos';
            } else if (type === 'text') {
                item.content = '';
                item.name = 'Documento de Texto';
            } else if (type === 'code') {
                item.content = '';
                item.language = 'javascript';
                item.name = 'Código';
            }

            folderItems.push(item);
            renderFolderItems();
            document.getElementById('addItemMenu').style.display = 'none';
        }

        function renderFolderItems() {
            const itemsList = document.getElementById('itemsList');
            
            if (folderItems.length === 0) {
                itemsList.innerHTML = '<p style="color: #586069; text-align: center; padding: 20px;">Nenhum item adicionado ainda</p>';
                return;
            }

            itemsList.innerHTML = '';

            folderItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'folder-item';
                
                const icon = item.type === 'upload' ? '📤' : item.type === 'text' ? '📝' : '💻';
                
                itemDiv.innerHTML = `
                    <div class="folder-item-header" onclick="toggleItem(${item.id})">
                        <div class="folder-item-title">
                            <button class="btn-toggle ${item.collapsed ? 'collapsed' : ''}" id="toggle-${item.id}">▼</button>
                            <span>${icon} ${item.name}</span>
                        </div>
                        <div class="folder-item-actions">
                            <button class="btn-delete-item" onclick="event.stopPropagation(); deleteItem(${item.id})">
                                🗑️ Remover
                            </button>
                        </div>
                    </div>
                    <div class="folder-item-content ${item.collapsed ? 'collapsed' : ''}" id="content-${item.id}">
                        ${renderItemContent(item)}
                    </div>
                `;
                
                itemsList.appendChild(itemDiv);
            });
        }

        function renderItemContent(item) {
            if (item.type === 'upload') {
                return `
                    <div class="upload-area" onclick="document.getElementById('fileInput-${item.id}').click()">
                        <div class="upload-icon">📤</div>
                        <p class="upload-text">Arraste arquivos ou clique para selecionar</p>
                        <p class="upload-hint">Suporta múltiplos arquivos</p>
                        <input type="file" id="fileInput-${item.id}" multiple hidden onchange="handleFileSelect(${item.id}, event)">
                        <button class="btn-upload" onclick="event.stopPropagation();">Escolher Arquivos</button>
                    </div>
                    <div class="files-list" id="filesList-${item.id}"></div>
                `;
            } else if (item.type === 'text') {
                return `<textarea class="text-editor" id="textEditor-${item.id}" placeholder="Comece a escrever..." oninput="updateItemContent(${item.id}, this.value)">${item.content || ''}</textarea>`;
            } else if (item.type === 'code') {
                return `
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <label style="font-weight: 500; color: #2c3e50;">Linguagem:</label>
                        <select class="editor-lang-select" id="codeLang-${item.id}" onchange="updateItemLanguage(${item.id}, this.value)">
                            <option value="javascript" ${item.language === 'javascript' ? 'selected' : ''}>JavaScript</option>
                            <option value="python" ${item.language === 'python' ? 'selected' : ''}>Python</option>
                            <option value="html" ${item.language === 'html' ? 'selected' : ''}>HTML</option>
                            <option value="css" ${item.language === 'css' ? 'selected' : ''}>CSS</option>
                            <option value="java" ${item.language === 'java' ? 'selected' : ''}>Java</option>
                            <option value="cpp" ${item.language === 'cpp' ? 'selected' : ''}>C++</option>
                        </select>
                    </div>
                    <textarea class="code-editor" id="codeEditor-${item.id}" placeholder="// Comece a programar..." oninput="updateItemContent(${item.id}, this.value)">${item.content || ''}</textarea>
                `;
            }
        }

        function toggleItem(itemId) {
            const item = folderItems.find(i => i.id === itemId);
            if (item) {
                item.collapsed = !item.collapsed;
                const contentDiv = document.getElementById(`content-${itemId}`);
                const toggleBtn = document.getElementById(`toggle-${itemId}`);
                
                if (item.collapsed) {
                    contentDiv.classList.add('collapsed');
                    toggleBtn.classList.add('collapsed');
                } else {
                    contentDiv.classList.remove('collapsed');
                    toggleBtn.classList.remove('collapsed');
                }
            }
        }

        function deleteItem(itemId) {
            if (confirm('Remover este item?')) {
                folderItems = folderItems.filter(i => i.id !== itemId);
                renderFolderItems();
            }
        }

        function updateItemContent(itemId, content) {
            const item = folderItems.find(i => i.id === itemId);
            if (item) {
                item.content = content;
            }
        }

        function updateItemLanguage(itemId, language) {
            const item = folderItems.find(i => i.id === itemId);
            if (item) {
                item.language = language;
            }
        }

        function handleFileSelect(itemId, event) {
            const files = Array.from(event.target.files);
            const item = folderItems.find(i => i.id === itemId);
            
            if (!item) return;

            files.forEach(file => {
                const fileSizeMB = file.size / (1024 * 1024);
                
                let totalSize = 0;
                folderItems.forEach(i => {
                    if (i.type === 'upload' && i.files) {
                        i.files.forEach(f => totalSize += f.size / (1024 * 1024));
                    }
                });
                
                if (totalSize + fileSizeMB > maxSize) {
                    alert(`Não é possível adicionar "${file.name}". Limite de ${maxSize >= 1024 ? (maxSize/1024).toFixed(1) + ' GB' : maxSize + ' MB'} seria excedido.`);
                    return;
                }
                
                item.files.push(file);
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    item.filesData.push({
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        data: e.target.result
                    });
                    updateFilesList(itemId);
                };
                reader.readAsDataURL(file);
            });
            
            updateFilesList(itemId);
        }

        function updateFilesList(itemId) {
            const item = folderItems.find(i => i.id === itemId);
            if (!item || !item.files) return;

            const filesList = document.getElementById(`filesList-${itemId}`);
            
            if (item.files.length === 0) {
                filesList.innerHTML = '';
                return;
            }

            filesList.innerHTML = '<h4 style="margin: 15px 0 10px 0; color: #2c3e50;">Arquivos:</h4>';
            
            item.files.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-item';
                fileDiv.innerHTML = `
                    <div class="file-info">
                        <div class="file-icon">${getFileIcon(file.name)}</div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                    <button class="btn-remove" onclick="removeFileFromItem(${itemId}, ${index})">Remover</button>
                `;
                filesList.appendChild(fileDiv);
            });
        }

        function removeFileFromItem(itemId, fileIndex) {
            const item = folderItems.find(i => i.id === itemId);
            if (item) {
                item.files.splice(fileIndex, 1);
                item.filesData.splice(fileIndex, 1);
                updateFilesList(itemId);
            }
        }

        function selectPlan(planType, sizeLimit) {
            currentPlan = planType;
            maxSize = sizeLimit;
            
            const config = planConfigs[planType];
            
            document.getElementById('selectedPlan').textContent = config.name;
            document.getElementById('sizeLimit').textContent = `${sizeLimit >= 1024 ? (sizeLimit/1024).toFixed(1) + ' GB' : sizeLimit + ' MB'}`;
            document.getElementById('validity').textContent = config.validity;
            
            const passwordSection = document.getElementById('passwordSection');
            if (config.hasPassword) {
                passwordSection.style.display = 'block';
            } else {
                passwordSection.style.display = 'none';
            }
            
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('plansSection').style.display = 'none';
            document.getElementById('createSection').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            folderItems = [];
            itemIdCounter = 0;
            renderFolderItems();
        }

        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const iconMap = {
                'pdf': '📄', 'doc': '📝', 'docx': '📝',
                'xls': '📊', 'xlsx': '📊', 'ppt': '📊', 'pptx': '📊',
                'jpg': '🖼️', 'jpeg': '🖼️', 'png': '🖼️', 'gif': '🖼️',
                'mp4': '🎥', 'avi': '🎥', 'mov': '🎥',
                'mp3': '🎵', 'wav': '🎵',
                'zip': '🗜️', 'rar': '🗜️',
                'txt': '📃', 'js': '💻', 'html': '💻', 'css': '💻'
            };
            return iconMap[ext] || '📎';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        }

        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${day}/${month}/${year} às ${hours}:${minutes}`;
        }

        function createFolder() {
            console.log('🚀 createFolder chamado!');
            console.log('📝 Folder items:', JSON.parse(JSON.stringify(folderItems)));
            
            const folderName = document.getElementById('folderName').value.trim();
            
            if (!folderName) {
                alert('Por favor, dê um nome para a pasta.');
                return;
            }
            
            if (folderItems.length === 0) {
                alert('Por favor, adicione pelo menos um item à pasta.');
                return;
            }
            
            for (let item of folderItems) {
                if (item.type === 'upload' && (!item.files || item.files.length === 0)) {
                    alert('Um dos itens de arquivo está vazio. Adicione arquivos ou remova o item.');
                    return;
                }
                if ((item.type === 'text' || item.type === 'code') && !item.content) {
                    alert('Um dos itens de texto/código está vazio. Adicione conteúdo ou remova o item.');
                    return;
                }
            }
            
            console.log('✅ Validação passou!');
            saveFolderAndShowLink();
        }

        // ====== SALVAR NO FIREBASE (Storage + Firestore) - SEM FALLBACK LOCAL ======
        async function saveFolderAndShowLink() {
            console.log('💾 saveFolderAndShowLink chamado!');
            
            const folderName = document.getElementById('folderName').value;
            const creatorName = document.getElementById('creatorName').value.trim() || 'Anônimo';
            const password = document.getElementById('folderPassword').value;
            const config = planConfigs[currentPlan];
            
            const uniqueId = generateUniqueId();
            console.log('🆔 Pasta ID:', uniqueId);
            
            try {
                console.log('🔄 Processando items...');
                const processedItems = [];
                
                for (const item of folderItems) {
                    const processed = {
                        id: item.id,
                        type: item.type,
                        name: item.name
                    };
                    
                    if (item.type === 'upload' && item.filesData && item.filesData.length > 0) {
                        console.log(`📤 Enviando ${item.filesData.length} arquivo(s) para Firebase Storage...`);
                        processed.filesData = [];
                        
                        for (const fileData of item.filesData) {
                            try {
                                console.log(`  📎 Enviando: ${fileData.name}`);
                                
                                // Converter base64 para Blob
                                const base64Data = fileData.data.split(',')[1];
                                const byteCharacters = atob(base64Data);
                                const byteNumbers = new Array(byteCharacters.length);
                                for (let i = 0; i < byteCharacters.length; i++) {
                                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                                }
                                const byteArray = new Uint8Array(byteNumbers);
                                const blob = new Blob([byteArray], { type: fileData.type });
                                
                                // Upload para Storage
                                const fileName = `${Date.now()}_${fileData.name}`;
                                const storageRef = storage.ref(`pastas/${uniqueId}/${fileName}`);
                                
                                await storageRef.put(blob);
                                const downloadURL = await storageRef.getDownloadURL();
                                
                                processed.filesData.push({
                                    name: fileData.name,
                                    type: fileData.type,
                                    size: fileData.size,
                                    url: downloadURL
                                });
                                
                                console.log(`  ✅ ${fileData.name} enviado com sucesso!`);
                            } catch (uploadError) {
                                console.error(`  ❌ Erro ao enviar ${fileData.name}:`, uploadError);
                                throw uploadError; // Propagar erro - SEM FALLBACK
                            }
                        }
                    } else if (item.type === 'text' || item.type === 'code') {
                        processed.content = item.content || '';
                        if (item.type === 'code') {
                            processed.language = item.language || 'javascript';
                        }
                    }
                    
                    processedItems.push(processed);
                }
                
                console.log('✅ Items prontos para o Firestore:', processedItems);
                
                // Criar documento no Firestore - APENAS FIREBASE, SEM LOCAL
                const folderData = {
                    id: uniqueId,
                    creatorName: creatorName,
                    name: folderName,
                    plan: currentPlan,
                    password: password || null,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    expiresAt: firebase.firestore.Timestamp.fromDate(new Date(Date.now() + config.validityHours * 60 * 60 * 1000)),
                    items: processedItems,
                    views: 0
                };
                
                console.log('📊 Documento pronto para Firestore:');
                console.log('  - ID:', folderData.id);
                console.log('  - Nome:', folderData.name);
                console.log('  - Criador:', folderData.creatorName);
                console.log('  - Plano:', folderData.plan);
                console.log('  - Items:', folderData.items.length);
                console.log('  - Tamanho total:', JSON.stringify(folderData).length, 'bytes');
                
                // SALVANDO NO FIREBASE - SEM QUALQUER FALLBACK PARA LOCAL
                console.log('💾 Salvando no Firestore...');
                await db.collection('pastas').doc(uniqueId).set(folderData);
                console.log('✅ Pasta salva com SUCESSO no Firebase!');
                console.log('🔗 Acesse em: https://theherick.github.io/past/?id=' + uniqueId);
                
                showLinkSection(uniqueId);
                
            } catch (error) {
                console.error('❌ Erro ao salvar:', error);
                alert('❌ Erro ao salvar pasta: ' + error.message);
            }
        }

        function showLinkSection(uniqueId) {
            console.log('🔗 showLinkSection chamado com ID:', uniqueId);
            
            const folderName = document.getElementById('folderName').value || 'Pasta';
            const password = document.getElementById('folderPassword').value;
            const config = planConfigs[currentPlan];
            
            const link = `https://theherick.github.io/past/?id=${uniqueId}`;
            
            document.getElementById('generatedLink').value = link;
            
            let totalSize = 0;
            let itemCount = folderItems.length;
            
            folderItems.forEach(item => {
                if (item.type === 'upload' && item.files) {
                    item.files.forEach(f => totalSize += f.size / (1024 * 1024));
                }
            });
            
            document.getElementById('totalSize').textContent = totalSize > 0 ? totalSize.toFixed(2) + ' MB' : '-';
            document.getElementById('fileCount').textContent = itemCount + ' item(ns)';
            document.getElementById('expiryTime').textContent = formatDate(new Date(Date.now() + config.validityHours * 60 * 60 * 1000));
            
            if (password) {
                document.getElementById('passwordInfo').style.display = 'flex';
            } else {
                document.getElementById('passwordInfo').style.display = 'none';
            }
            
            document.getElementById('createSection').style.display = 'none';
            document.getElementById('linkSection').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function generateUniqueId() {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function copyLink() {
            const linkInput = document.getElementById('generatedLink');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                const copyBtn = document.querySelector('.btn-copy');
                const copyText = document.getElementById('copyText');
                
                copyBtn.classList.add('copied');
                copyText.textContent = '✓ Copiado!';
                
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                    copyText.textContent = 'Copiar';
                }, 2000);
            } catch (err) {
                alert('Link: ' + linkInput.value);
            }
        }

        function openLink() {
            const link = document.getElementById('generatedLink').value;
            window.open(link, '_blank');
        }

        function createAnother() {
            folderItems = [];
            itemIdCounter = 0;
            document.getElementById('folderName').value = '';
            document.getElementById('creatorName').value = '';
            document.getElementById('folderPassword').value = '';
            
            document.getElementById('linkSection').style.display = 'none';
            document.getElementById('heroSection').style.display = 'block';
            document.getElementById('plansSection').style.display = 'block';
            document.getElementById('addItemMenu').style.display = 'none';
            
            const btnCreate = document.getElementById('btnCreate');
            btnCreate.disabled = false;
            
            renderFolderItems();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Carregar pasta ao iniciar
        window.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Página carregada!');
            
            const urlParams = new URLSearchParams(window.location.search);
            const folderId = urlParams.get('id');
            
            if (folderId) {
                console.log('📁 Carregando pasta:', folderId);
            } else {
                console.log('🏠 Página inicial');
                document.getElementById('heroSection').style.display = 'block';
                document.getElementById('plansSection').style.display = 'block';
            }
        });
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAexCf7hPN2OQvfsw66UDpci6nycivrK98",
            authDomain: "void-activation-system.firebaseapp.com",
            databaseURL: "https://void-activation-system-default-rtdb.firebaseio.com",
            projectId: "void-activation-system",
            storageBucket: "void-activation-system.firebasestorage.app",
            messagingSenderId: "108268095097",
            appId: "1:108268095097:web:4f45ff75a9e528b3f0f6a8",
            measurementId: "G-P71BZFRDQB"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        console.log('🔥 Firebase inicializado com sucesso!');
        console.log('📦 Storage:', storage);
        console.log('📋 Firestore:', db);
    </script>
</body>
</html>
